# Redis设计与实现
## Czp
---

章节 | 内容
:---: | :---:
[1](#简单动态字符串) | 字符串
[2](#) | 


# 简单动态字符串
## SDS
---

1. 数据结构
   > free
   > len
   > buf
2. free → 未使用空间
   (根据)
3. len → 字符串长度
   (不包含字符串末尾的空字符)
4. buf → 存储字符串内容
5. 因为C字符串不记录自身长度,所以容易造成缓冲区溢出
   > 在修改C字符串时如果没有提前分配内存,因为分配空间不够,容易造成其他字符串意外被修改   

   > 每次修改需要重新分配内存 → SDS通过使用未使用空间free来进行空间预分配和惰性空间释放   
6. SDS在修改时会先检查len是否足够,如果不够,则拓展SDS的len和free为修改后的长度
7. 空间预分配:
   > 优化SDS字符串增长操作 → 在对SDS进行修改时同时修改len和free   
   
   > 此时buf长度就变为了len+free+1
   
   > 这样当下次增长操作来的时候,先判断free是否足够,如果足够直接就插入进去了(无需分配内存)
8. 惰性空间释放:
   > 优化SDS字符串缩短操作 → 不立即收回多出来的字节,而是存到free中
9. C字符串不能包含空字符,否则最先被程序读入的空字符将被误认为是字符串结尾,所以只能保留文本信息
10. Redis的所有SDS API都是以二进制的方式来处理SDS存放在buf数组里的数据,不做任何处理(二进制安全)